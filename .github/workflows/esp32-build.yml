name: ESP32 Build

on:
  push:
    branches: [main]
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v3

    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y cmake ninja-build ccache libffi-dev libssl-dev dfu-util

    - name: Clone ESP-IDF
      run: |
        git clone --recursive https://github.com/espressif/esp-idf.git
        cd esp-idf
        ./install.sh esp32

    - name: Build ESP32 project
      run: |
        . $GITHUB_WORKSPACE/esp-idf/export.sh
        cd src        # change if your project root is elsewhere
        idf.py set-target esp32
        idf.py build
